<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Family Budget</title>
    <link rel="icon" type="image/x-icon" href="favicon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <base target="_top">

    <style>
      .notification {
        display: none;
      }

      .notification.active {
        display: block;
      }

      .navbar-item img {
        max-height: none;
      }
    </style>
  </head>
  <body>
    <nav class="navbar" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <a class="navbar-item" href="#">
          <img src="logo.png"
          alt="Family App to manage personal finance" width="120" height="48"/>
        </a>
    </div>
  </nav>
  
  <section class="section">
    <div class="container">
      <div class="field">
        <label class="label">Denaro speso</label>
        <div class="control">
          <input id="exp-amount" class="input" type="number" placeholder="Text input">
        </div>
      </div>
    
      <div class="field">
        <label class="label">Tipo di spesa</label>
        <div class="control">
          <div class="select">
            <select id="exp-type">
              <option value="1">Spesa Alimentare</option>
              <option value="2">Altro</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="field">
        <label class="label">Note</label>
        <div class="control">
          <input id="exp-notes" class="input" type="text" placeholder="Dettagli...">
        </div>
      </div>
      
      <div class="field is-grouped">
        <div class="control">
          <button id="submit-button" class="button is-link">Salva</button>
        </div>
      </div>
    </div>
  </section>

  <div class="notification is-primary is-light">
    <button class="delete"></button>
  </div>

  <div class="notification is-danger is-light">
    <button class="delete"></button>
  </div>

  <script>
    let submit = document.querySelector('#submit-button');
    let notification = document.querySelector('.notification.is-primary');
    let error = document.querySelector('.notification.is-danger');

    function sendExp() {
      let expType = document.querySelector('#exp-type').value;
      let expAmount = document.querySelector('#exp-amount').value;
      let expNotes = document.querySelector('#exp-notes').value;
      
      expAmount.replace(",",".")

      if (!expAmount) {
       error.appendChild(document.createTextNode("Inserire una cifra"));
        error.classList.add('active');

        setTimeout(() => {
          error.parentNode.removeChild(notification);
          location.reload();
        }, 3000); 

        return;
      }

      fetch('https://script.google.com/macros/s/AKfycbxe267MB1efck7I57w4-teoGqEIOurMn_5a1dJa9bKleu8pVVPCvTZa112txEiJl7BM/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          type: expType,
          amount: expAmount,
          notes: expNotes
        })
      }).then(function (response) {
        notification.appendChild(document.createTextNode("Salvato."));
        notification.classList.add('active');
        
        setTimeout(() => {
          notification.parentNode.removeChild(notification);
          location.reload();
        }, 3000);
      }).catch(function (e) {
        notification.innerHTML = "Errore, aprire console per i dettagli."
        console.error(e);
      })
    }

    function showNotification(text) {
      notification.appendChild(document.createTextNode(text));

      notification.classList.add('active');
      setTimeout(() => {
        document.querySelector('.delete').click();
      }, 3000);
    }
    
    submit.addEventListener("click", sendExp);
  </script>
</body>

</html>
